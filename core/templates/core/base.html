{% load static %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}TEM NO CAM{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'core/style.css' %}">
</head>
<body>
<!-- Botão de menu flutuante (aparece em telas menores) -->
<button class="hamburger-toggle" id="hamburger-toggle">
    <span></span>
</button>

<div class="layout sidebar-contracted">

    <!-- Barra Lateral -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="hamburger">
                <span></span>
            </div>
        </div>

        <nav class="sidebar-nav">
            <ul>
                {% if request.user.is_authenticated %}
                    <li>
                        <a href="{% url 'core:home' %}"
                           class="menu-link {% if request.path == '/' %}ativo{% endif %}">
                            Home
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'core:lista_itens' %}"
                           class="menu-link {% if '/itens' in request.path %}ativo{% endif %}">
                            Itens disponíveis
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'core:historico_reservas' %}"
                           class="menu-link {% if '/reservas' in request.path and '/gestao' not in request.path %}ativo{% endif %}">
                            Histórico de Reservas
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'core:editar_conta' %}"
                           class="menu-link {% if '/conta/editar' in request.path %}ativo{% endif %}">
                            Editar Conta
                        </a>
                    </li>

                    {% if request.user.tipo_acesso != 'Aluno' %}
                        <hr>
                        <li><strong>Gestão</strong></li>
                        <li>
                            <a href="{% url 'core:registrar_retirada_manual' %}"
                               class="menu-link {% if 'gestao/registrar-retirada-manual' in request.path %}ativo{% endif %}">
                                Retirada Manual
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'core:reservas_pendentes' %}"
                               class="menu-link {% if 'gestao/reservas/pendentes' in request.path %}ativo{% endif %}">
                                Validação
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'core:reservas_ativas' %}"
                               class="menu-link {% if 'gestao/reservas/ativas' in request.path %}ativo{% endif %}">
                                Reservas ativas
                            </a>
                        </li>
                    {% endif %}

                    {% if request.user.tipo_acesso == 'Diretoria' %}
                        <hr>
                        <li><strong>Dados do Sistema</strong></li>
                        <li>
                            <a href="{% url 'core:modificar_estoque' %}"
                               class="menu-link {% if 'gestao/modificar-estoque' in request.path %}ativo{% endif %}">
                                Modificar estoque
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'core:lista_usuarios' %}"
                               class="menu-link {% if 'gestao/usuarios' in request.path %}ativo{% endif %}">
                                Gerenciar acesso
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'core:historico_reservas_completo' %}"
                               class="menu-link {% if 'historico-completo' in request.path %}ativo{% endif %}">
                                Histórico de Reservas
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'core:estatisticas' %}"
                               class="menu-link {% if 'estatisticas' in request.path %}ativo{% endif %}">
                                Estatísticas
                            </a>
                        </li>
                    {% endif %}

                    <hr>
                    <li>
                        <a href="{% url 'logout' %}" class="menu-link">
                            Sair
                        </a>
                    </li>
                {% else %}
                    <li>
                        <a href="{% url 'login' %}"
                           class="menu-link {% if 'login' in request.path %}ativo{% endif %}">
                            Login
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'signup' %}"
                           class="menu-link {% if 'signup' in request.path %}ativo{% endif %}">
                            Cadastro
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    </aside>

    <!-- Conteúdo Principal -->
    <main class="main">
        <div class="page-content">
            {% block content %}{% endblock %}
        </div>
    </main>
</div>

    <footer class="site-footer">
        <p>&copy; 2025 TEM NO CAM. Betin, Roses, Geovas.</p>
    </footer>

<!-- Overlay escuro atrás da barra lateral  em telas pequenas -->
<div class="sidebar-overlay" id="sidebar-overlay"></div>

<!-- Script para abrir/fechar o menu lateral em telas pequenas -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
    const toggle = document.getElementById('hamburger-toggle');
    const sidebar = document.querySelector('.sidebar');
    const overlay = document.getElementById('sidebar-overlay');

    if (!toggle || !sidebar || !overlay) return;

    function abrirSidebar() {
        sidebar.classList.add('sidebar-aberta');
        overlay.classList.add('overlay-visivel');
        // botão em X
        toggle.classList.add('open');
        // rolagem na aba lateral quando aberta - não rolar a principal
        document.body.style.overflow = 'hidden';
    }

    function fecharSidebar() {
        sidebar.classList.remove('sidebar-aberta');
        overlay.classList.remove('overlay-visivel');
        // voltar botão hambúguer
        toggle.classList.remove('open');
        // restaurar rolagem do corpo
        document.body.style.overflow = '';
    }

    toggle.addEventListener('click', function() {
        if (sidebar.classList.contains('sidebar-aberta')) {
            fecharSidebar();
        } else {
            abrirSidebar();
        }
    });

    // Botão X se sidebar já estiver aberta (ex: ao recarregar a página)
    if (sidebar.classList.contains('sidebar-aberta')) {
        toggle.classList.add('open');
    } else {
        toggle.classList.remove('open');
    }

    overlay.addEventListener('click', fecharSidebar);
});
</script>
<script>
// Desktop: torna a barra lateral retrátil clicando no hambúrguer interno
document.addEventListener('DOMContentLoaded', function() {
    const layout = document.querySelector('.layout');
    const sidebarHamburger = document.querySelector('.sidebar .hamburger');
    const menuLinks = document.querySelectorAll('.menu-link');
    const floatingToggle = document.getElementById('hamburger-toggle');

    if (!layout || !sidebarHamburger) return;

    // Mapas de rótulos curtos personalizados
    const shortMap = {
      'Home': 'In',
      'Itens disponíveis': 'It',
      'Histórico de Reservas': 'HR',
      'Validação (pendentes)': 'VP',
      'Reservas ativas': 'RA',
      'Gerenciar acesso': 'GA',
      'Estatísticas': 'ES',
      'Sair': 'S',
      'Login': 'L',
      'Cadastro': 'C'
    };

    // Adiciona atributo data-short a cada link usando o mapa, ou gera uma abreviação reserva
    menuLinks.forEach(link => {
        const raw = (link.textContent || '');
        const text = raw.replace(/\s+/g, ' ').trim();
        let short = shortMap[text];
        if (!short) {
            // reserva: usar iniciais das duas primeiras palavras ou duas primeiras letras
            const parts = text.split(' ').filter(Boolean);
            if (parts.length >= 2) {
                short = (parts[0].charAt(0) + parts[1].charAt(0)).toUpperCase();
            } else if (parts.length === 1) {
                short = parts[0].substring(0, 2).toUpperCase();
            } else {
                short = '';
            }
        }
        link.setAttribute('data-short', short);
        // também adiciona title para dica quando tiver o texto escondido
        if (!link.getAttribute('title')) link.setAttribute('title', text);
    });

    // Persistência: ler preferência do armazenamento local e aplicar
    const pref = localStorage.getItem('sidebarContracted');
    if (pref === 'false') {
        layout.classList.remove('sidebar-contracted');
    } else if (pref === 'true') {
        layout.classList.add('sidebar-contracted');
    }

    // Função para salvar preferência (true = contraída)
    function savePref() {
        const contracted = layout.classList.contains('sidebar-contracted');
        localStorage.setItem('sidebarContracted', contracted ? 'true' : 'false');
    }

    sidebarHamburger.addEventListener('click', function(e) {
            // alternar classe no layout
            layout.classList.toggle('sidebar-contracted');
            // animar hambúrguer: aberto quando expandido
            const isContracted = layout.classList.contains('sidebar-contracted');
            if (isContracted) {
                sidebarHamburger.classList.remove('open');
            } else {
                sidebarHamburger.classList.add('open');
            }
            // salvar preferência quando usuário alterna no desktop
            savePref();
            // sincronizar estado do botão flutuante também (se usuário expandir no desktop, o botão flutuante mostra X)
            if (floatingToggle) {
                if (isContracted) floatingToggle.classList.remove('open'); else floatingToggle.classList.add('open');
            }
    });
        // definir estado inicial do hambúrguer de acordo com o layout
        const initialContracted = layout.classList.contains('sidebar-contracted');
        if (initialContracted) {
            sidebarHamburger.classList.remove('open');
        } else {
            sidebarHamburger.classList.add('open');
        }
        // sincronizar estado inicial do botão flutuante
        if (floatingToggle) {
            if (initialContracted) floatingToggle.classList.remove('open'); else floatingToggle.classList.add('open');
        }
});
</script>
</body>

</html>

